<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlueLook Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://www.canvasjs.com/assets/script/canvasjs.min.js"></script> <!-- For charts -->
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
      color: #212121;
      line-height: 1.6;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      max-width: 950px;
      margin: 30px auto;
      padding: 30px;
      background: #ffffff;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      border-radius: 24px;
      text-align: center;
    }

    h1 {
      font-size: 2.5em;
      color: #0d47a1;
      margin-bottom: 0.6em;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.15);
    }

    .dashboard-sections {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 40px;
    }

    .section-box {
      background: linear-gradient(to bottom, #f9fbfd, #e3f2fd);
      padding: 40px;
      border-radius: 18px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      text-align: center;
      cursor: pointer;
      flex: 1 1 300px;
      max-width: 400px;
      transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    }

    .section-box:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      background: linear-gradient(to bottom, #e8f4fd, #d4eafd);
    }

    .section-box h2 {
      font-size: 1.8em;
      color: #0d47a1;
      margin-bottom: 10px;
    }

    .section-box p {
      font-size: 1em;
      color: #424242;
    }

    .section-content {
      display: none;
      margin-top: 20px;
    }

    .back-button {
      display: inline-block;
      background: linear-gradient(to right, #2196f3, #1976d2);
      color: #fff;
      padding: 12px 24px;
      font-size: 1em;
      border: none;
      border-radius: 10px;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
      margin-bottom: 30px;
    }

    .back-button:hover {
      background: linear-gradient(to right, #1976d2, #0d47a1);
      transform: scale(1.05);
    }

    /* File Management Section Styles */
    .file-list {
      list-style: none;
      padding: 0;
    }

    .file-item {
      background: #f9fbfd;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.3s ease;
    }

    .file-item:hover {
      transform: translateY(-5px);
    }

    .file-actions button {
      background: linear-gradient(to right, #2196f3, #1976d2);
      color: #fff;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 10px;
      transition: background 0.3s ease;
    }

    .file-actions button:hover {
      background: linear-gradient(to right, #1976d2, #0d47a1);
    }

    /* Profit Recording Section Styles */
    .profits-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      max-width: 600px;
      margin: 0 auto 40px;
    }

    .profits-form label {
      grid-column: 1 / 2;
      text-align: right;
      align-self: center;
    }

    .profits-form input, .profits-form select {
      grid-column: 2 / 3;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1em;
    }

    .profits-form button {
      grid-column: 1 / 3;
      margin-top: 10px;
    }

    .total-profits {
      font-size: 2em;
      color: #27ae60;
      margin-bottom: 20px;
    }

    .sales-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }

    .sales-table th, .sales-table td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    .sales-table th {
      background: #e3f2fd;
      color: #0d47a1;
    }

    .chart-container {
      margin-top: 40px;
      height: 400px;
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      .profits-form {
        grid-template-columns: 1fr;
      }

      .profits-form label {
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>BlueLook Dashboard</h1>

    <div class="dashboard-sections">
      <div class="section-box" onclick="showSection('fileManagement')">
        <h2>File Managing</h2>
        <p>Manage your files, upload, edit, and delete.</p>
      </div>
      <div class="section-box" onclick="showSection('profitRecording')">
        <h2>Profit Recording</h2>
        <p>Log sales, view records, and track total profits.</p>
      </div>
    </div>

    <!-- File Management Section -->
    <div id="fileManagement" class="section-content">
      <button class="back-button" onclick="backToDashboard()">Back to Dashboard</button>
      <h2>File Management</h2>
      <ul class="file-list" id="fileList"></ul>
      <button class="cta-button" onclick="showCreateModal()">Create New File</button>
    </div>

    <!-- Profit Recording Section -->
    <div id="profitRecording" class="section-content">
      <button class="back-button" onclick="backToDashboard()">Back to Dashboard</button>
      <h2>Profit Recording</h2>
      <form class="profits-form">
        <label for="clientDiscord">Client Discord:</label>
        <input type="text" id="clientDiscord" placeholder="e.g., user#1234">
        <label for="bypassType">Bypass Type:</label>
        <select id="bypassType">
          <option value="">Select type...</option>
          <option value="Lockdown Browser Premium">Lockdown Browser Premium</option>
          <option value="Lockdown Browser Standard">Lockdown Browser Standard</option>
          <option value="SAT/AP/PSAT Premium">SAT/AP/PSAT Premium</option>
          <option value="SAT/AP/PSAT Standard">SAT/AP/PSAT Standard</option>
          <option value="ACT Standard">ACT Standard</option>
        </select>
        <label for="amount">Amount (USD):</label>
        <input type="number" id="amount" placeholder="e.g., 390" step="0.01">
        <label for="saleDate">Sale Date:</label>
        <input type="date" id="saleDate" value="">
        <button type="button" class="cta-button" onclick="logSale()">Log Sale</button>
      </form>
      <div class="total-profits">Total Profits: $<span id="totalProfits">0.00</span></div>
      <table class="sales-table" id="salesTable">
        <thead>
          <tr>
            <th>Client Discord</th>
            <th>Bypass Type</th>
            <th>Amount (USD)</th>
            <th>Date</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="chartContainer" class="chart-container"></div>
      <button class="cta-button" onclick="exportToCSV()">Export to CSV</button>
    </div>
  </div>

  <!-- Create File Modal -->
  <div id="createModal" class="modal">
    <div class="modal-content">
      <h3>Create New File</h3>
      <input type="text" id="newFilename" placeholder="Filename (e.g., note.txt)">
      <textarea id="newContent" placeholder="Enter content here..."></textarea>
      <div class="buttons">
        <button class="save-btn" onclick="createFile()">Create</button>
        <button class="close-btn" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Edit File Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h3>Editing <span id="editFilename"></span></h3>
      <textarea id="editContent"></textarea>
      <div class="buttons">
        <button class="save-btn" onclick="saveFile()">Save</button>
        <button class="close-btn" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    let currentFilename = '';

    function showSection(sectionId) {
      document.getElementById('dashboardSections').style.display = 'none';
      document.querySelectorAll('.section-content').forEach(el => el.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
      if (sectionId === 'fileManagement') loadFiles();
      if (sectionId === 'profitRecording') loadSales();
    }

    function backToDashboard() {
      document.getElementById('dashboardSections').style.display = 'flex';
      document.querySelectorAll('.section-content').forEach(el => el.style.display = 'none');
    }

    // Close modal
    function closeModal() {
      document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
    }

    // Show create file modal
    function showCreateModal() {
      document.getElementById('createModal').style.display = 'flex';
    }

    // Load files
    function loadFiles() {
      fetch('/files/list')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const list = document.getElementById('fileList');
            list.innerHTML = '';
            data.files.forEach(file => {
              const li = document.createElement('li');
              li.className = 'file-item';
              li.innerHTML = `
                <span class="file-name">${file}</span>
                <div class="file-actions">
                  <button onclick="openFile('${file}')">Open/Edit</button>
                  <button onclick="deleteFile('${file}')">Delete</button>
                  <a href="/files/${encodeURIComponent(file)}" target="_blank">View</a>
                </div>
              `;
              list.appendChild(li);
            });
          }
        });
    }

    // Create file
    function createFile() {
      const filename = document.getElementById('newFilename').value.trim();
      const content = document.getElementById('newContent').value.trim();
      if (!filename || !content) return alert('Filename and content required');
      fetch('/files/write', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename, content })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          closeModal();
          loadFiles();
          alert('File created');
        }
      });
    }

    // Open file
    function openFile(filename) {
      fetch(`/files/read?filename=${encodeURIComponent(filename)}`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            currentFilename = filename;
            document.getElementById('editFilename').textContent = filename;
            document.getElementById('editContent').value = data.content;
            document.getElementById('editModal').style.display = 'flex';
          }
        });
    }

    // Save file
    function saveFile() {
      const content = document.getElementById('editContent').value;
      fetch('/files/write', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename: currentFilename, content })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          closeModal();
          loadFiles();
          alert('File saved');
        }
      });
    }

    // Delete file
    function deleteFile(filename) {
      if (confirm('Confirm delete?')) {
        fetch('/files/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ filename })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            loadFiles();
            alert('File deleted');
          }
        });
      }
    }

    // Load sales
    function loadSales() {
      fetch('/sales/list')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const tableBody = document.getElementById('salesTable').querySelector('tbody');
            tableBody.innerHTML = '';
            data.sales.forEach(sale => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${sale.discord}</td>
                <td>${sale.bypassType}</td>
                <td>$${sale.amount.toFixed(2)}</td>
                <td>${sale.date || 'N/A'}</td>
                <td>${new Date(sale.timestamp).toLocaleString()}</td>
              `;
              tableBody.appendChild(row);
            });
            document.getElementById('totalProfits').textContent = data.total.toFixed(2);
            renderChart(data.sales);
          }
        });
    }

    // Log sale (added date field)
    function logSale() {
      const discord = document.getElementById('clientDiscord').value.trim();
      const bypassType = document.getElementById('bypassType').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const date = document.getElementById('saleDate').value;
      if (!discord || !bypassType || isNaN(amount) || amount <= 0 || !date) {
        alert('Please fill all fields correctly.');
        return;
      }
      fetch('/sales/log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ discord, bypassType, amount, date })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('clientDiscord').value = '';
          document.getElementById('bypassType').value = '';
          document.getElementById('amount').value = '';
          document.getElementById('saleDate').value = '';
          loadSales();
          alert('Sale logged successfully!');
        } else {
          alert('Error: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error logging sale:', error);
        alert('Failed to log sale. Check console.');
      });
    }

    // Render sales chart
    function renderChart(sales) {
      const dataPoints = sales.map(sale => ({ label: sale.timestamp, y: sale.amount }));
      const chart = new CanvasJS.Chart("chartContainer", {
        animationEnabled: true,
        title: { text: "Sales Over Time" },
        axisY: { title: "Amount (USD)" },
        data: [{
          type: "column",
          dataPoints: dataPoints
        }]
      });
      chart.render();
    }

    // Export to CSV
    function exportToCSV() {
      fetch('/sales/list')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            let csv = 'Client Discord,Bypass Type,Amount,Date,Timestamp\n';
            data.sales.forEach(sale => {
              csv += `${sale.discord},${sale.bypassType},$${sale.amount.toFixed(2)},${sale.date || 'N/A'},${sale.timestamp}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sales.csv';
            a.click();
            URL.revokeObjectURL(url);
          }
        });
    }

    // Load data on page load
    window.onload = () => {
      loadFiles();
      loadSales();
    };
  </script>
</body>
</html>