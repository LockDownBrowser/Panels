<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlueLook Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- For sales chart -->
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
      color: #212121;
      line-height: 1.6;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      max-width: 950px;
      margin: 30px auto;
      padding: 30px;
      background: #ffffff;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      border-radius: 24px;
      text-align: center;
    }

    h1 {
      font-size: 2.5em;
      color: #0d47a1;
      margin-bottom: 0.6em;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.15);
    }

    .dashboard-sections {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 40px;
    }

    .section-box {
      background: linear-gradient(to bottom, #f9fbfd, #e3f2fd);
      padding: 40px;
      border-radius: 18px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      text-align: center;
      cursor: pointer;
      flex: 1 1 300px;
      max-width: 400px;
      transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    }

    .section-box:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      background: linear-gradient(to bottom, #e8f4fd, #d4eafd);
    }

    .section-box h2 {
      font-size: 1.8em;
      color: #0d47a1;
      margin-bottom: 10px;
    }

    .section-box p {
      font-size: 1em;
      color: #424242;
    }

    .section-content {
      display: none;
      margin-top: 20px;
    }

    .back-button {
      display: inline-block;
      background: linear-gradient(to right, #2196f3, #1976d2);
      color: #fff;
      padding: 12px 24px;
      font-size: 1em;
      border: none;
      border-radius: 10px;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
      margin-bottom: 30px;
    }

    .back-button:hover {
      background: linear-gradient(to right, #1976d2, #0d47a1);
      transform: scale(1.05);
    }

    /* File Management Section Styles */
    .file-list {
      list-style: none;
      padding: 0;
      display: grid;
      gap: 15px;
    }

    .file-item {
      background: #f9fbfd;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.3s ease;
    }

    .file-item:hover {
      transform: translateY(-5px);
    }

    .file-actions button {
      background: linear-gradient(to right, #2196f3, #1976d2);
      color: #fff;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 10px;
      transition: background 0.3s ease;
    }

    .file-actions button:hover {
      background: linear-gradient(to right, #1976d2, #0d47a1);
    }

    .file-actions a {
      background: linear-gradient(to right, #27ae60, #219653);
      color: #fff;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .file-actions a:hover {
      background: linear-gradient(to right, #219653, #1b5e20);
    }

    /* Profit Recording Section Styles */
    .profits-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      max-width: 600px;
      margin: 0 auto 30px;
    }

    .profits-form label {
      grid-column: 1 / 3;
      text-align: left;
      font-weight: 600;
      color: #0d47a1;
    }

    .profits-form input, .profits-form select {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1em;
      grid-column: 1 / 3;
    }

    .profits-form button {
      grid-column: 1 / 3;
      background: linear-gradient(to right, #2196f3, #1976d2);
      color: #fff;
      padding: 14px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .profits-form button:hover {
      background: linear-gradient(to right, #1976d2, #0d47a1);
    }

    .total-profits {
      font-size: 2em;
      color: #27ae60;
      margin-bottom: 20px;
      background: #f9fbfd;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .sales-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .sales-table th, .sales-table td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    .sales-table th {
      background: #e3f2fd;
      color: #0d47a1;
    }

    .sales-table td {
      background: #f9fbfd;
    }

    .finance-tools {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .finance-tools button {
      background: linear-gradient(to right, #27ae60, #219653);
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .finance-tools button:hover {
      background: linear-gradient(to right, #219653, #1b5e20);
    }

    #salesChart {
      max-width: 800px;
      margin: 40px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: #ffffff;
      padding: 30px;
      border-radius: 18px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      text-align: center;
    }

    .modal-content h3 {
      color: #0d47a1;
      margin-bottom: 20px;
      font-size: 1.5em;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    }

    .modal-content input, .modal-content textarea {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1em;
    }

    .modal-content .buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .save-btn, .close-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      cursor: pointer;
      transition: transform 0.3s ease, background 0.3s ease;
    }

    .save-btn {
      background: linear-gradient(to right, #2196f3, #1976d2);
      color: #fff;
    }

    .save-btn:hover {
      transform: scale(1.1);
      background: linear-gradient(to right, #1976d2, #0d47a1);
    }

    .close-btn {
      background: #bdc3c7;
      color: #333;
    }

    .close-btn:hover {
      transform: scale(1.1);
      background: #95a5a6;
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      .dashboard-sections {
        flex-direction: column;
      }

      .section-box {
        max-width: 100%;
      }

      .profits-form {
        grid-template-columns: 1fr;
      }

      .sales-table th, .sales-table td {
        padding: 8px;
        font-size: 0.9em;
      }

      .finance-tools {
        flex-direction: column;
      }

      #salesChart {
        max-width: 100%;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>BlueLook Dashboard</h1>

    <div class="dashboard-sections" id="dashboardSections">
      <div class="section-box" onclick="showSection('fileManagement')">
        <h2>File Managing</h2>
        <p>Manage your files, upload, edit, and delete.</p>
      </div>
      <div class="section-box" onclick="showSection('profitRecording')">
        <h2>Profit Recording</h2>
        <p>Log sales, view records, and track total profits.</p>
      </div>
    </div>

    <!-- File Management Section -->
    <div id="fileManagement" class="section-content">
      <button class="back-button" onclick="backToDashboard()">Back to Dashboard</button>
      <h2>File Management</h2>
      <ul class="file-list" id="fileList"></ul>
      <button class="cta-button" onclick="showCreateModal()">Create New File</button>
    </div>

    <!-- Profit Recording Section */
    <div id="profitRecording" class="section-content">
      <button class="back-button" onclick="backToDashboard()">Back to Dashboard</button>
      <h2>Profit Recording</h2>
      <div class="profits-form">
        <label for="clientDiscord">Client Discord:</label>
        <input type="text" id="clientDiscord" placeholder="e.g., user#1234">
        <label for="bypassType">Bypass Type:</label>
        <select id="bypassType">
          <option value="">Select type...</option>
          <option value="Lockdown Browser Premium">Lockdown Browser Premium</option>
          <option value="Lockdown Browser Standard">Lockdown Browser Standard</option>
          <option value="SAT/AP/PSAT Premium">SAT/AP/PSAT Premium</option>
          <option value="SAT/AP/PSAT Standard">SAT/AP/PSAT Standard</option>
          <option value="ACT Standard">ACT Standard</option>
        </select>
        <label for="amount">Amount (USD):</label>
        <input type="number" id="amount" placeholder="e.g., 390" min="0" step="0.01">
        <label for="saleDate">Sale Date:</label>
        <input type="date" id="saleDate">
        <button class="cta-button" onclick="logSale()">Log Sale</button>
      </div>
      <div class="total-profits">Total Profits: $<span id="totalProfits">0.00</span></div>
      <table class="sales-table" id="salesTable">
        <thead>
          <tr>
            <th>Client Discord</th>
            <th>Bypass Type</th>
            <th>Amount (USD)</th>
            <th>Date</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="finance-tools">
        <button class="cta-button" onclick="exportToCSV()">Export to CSV</button>
        <button class="cta-button" onclick="filterSales()">Filter by Date</button>
      </div>
      <canvas id="salesChart"></canvas>
    </div>
  </div>

  <!-- Create File Modal -->
  <div id="createModal" class="modal">
    <div class="modal-content">
      <h3>Create New File</h3>
      <input type="text" id="newFilename" placeholder="Filename (e.g., note.txt)">
      <textarea id="newContent" placeholder="Enter content here..."></textarea>
      <div class="buttons">
        <button class="save-btn" onclick="createFile()">Create</button>
        <button class="close-btn" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Edit File Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h3>Editing <span id="editFilename"></span></h3>
      <textarea id="editContent"></textarea>
      <div class="buttons">
        <button class="save-btn" onclick="saveFile()">Save</button>
        <button class="close-btn" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    let currentFilename = '';
    let salesData = []; // To store sales for chart and export

    function showSection(sectionId) {
      document.getElementById('dashboardSections').style.display = 'none';
      document.querySelectorAll('.section-content').forEach(el => el.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
      if (sectionId === 'fileManagement') loadFiles();
      if (sectionId === 'profitRecording') loadSales();
    }

    function backToDashboard() {
      document.getElementById('dashboardSections').style.display = 'flex';
      document.querySelectorAll('.section-content').forEach(el => el.style.display = 'none');
    }

    // Load and display files
    function loadFiles() {
      fetch('/files/list')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const list = document.getElementById('fileList');
            list.innerHTML = '';
            if (data.files.length === 0) {
              list.innerHTML = '<li class="file-item">No files available.</li>';
            } else {
              data.files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                const nameSpan = document.createElement('span');
                nameSpan.className = 'file-name';
                nameSpan.textContent = file;
                li.appendChild(nameSpan);

                const actions = document.createElement('div');
                actions.className = 'file-actions';
                const openBtn = document.createElement('button');
                openBtn.textContent = 'Open/Edit';
                openBtn.onclick = () => openFile(file);
                actions.appendChild(openBtn);

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = () => deleteFile(file);
                actions.appendChild(deleteBtn);

                const viewLink = document.createElement('a');
                viewLink.href = `/files/${encodeURIComponent(file)}`;
                viewLink.target = '_blank';
                viewLink.textContent = 'View';
                actions.appendChild(viewLink);

                li.appendChild(actions);
                list.appendChild(li);
              });
            }
          } else {
            alert('Error loading files: ' + data.message);
          }
        })
        .catch(error => console.error('Fetch error:', error));
    }

    // Create a new file
    function createFile() {
      const filename = document.getElementById('newFilename').value.trim();
      const content = document.getElementById('newContent').value.trim();
      if (!filename || !content) {
        alert('Please enter a filename and content.');
        return;
      }
      if (!/\.(txt|js|html)$/.test(filename)) {
        alert('Filename must end with .txt, .js, or .html');
        return;
      }
      fetch('/files/write', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename, content })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          closeModal();
          loadFiles();
          alert('File created successfully!');
        } else {
          alert('Error: ' + data.message);
        }
      })
      .catch(error => console.error('Error creating file:', error));
    }

    // Open file for editing
    function openFile(filename) {
      fetch(`/files/read?filename=${encodeURIComponent(filename)}`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            currentFilename = filename;
            document.getElementById('editFilename').textContent = filename;
            document.getElementById('editContent').value = data.content || '';
            document.getElementById('editModal').style.display = 'flex';
          } else {
            alert('Error: ' + data.message);
          }
        })
        .catch(error => console.error('Error opening file:', error));
    }

    // Save edited file
    function saveFile() {
      const content = document.getElementById('editContent').value;
      if (!content) {
        alert('Please enter some content to save.');
        return;
      }
      fetch('/files/write', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename: currentFilename, content })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          closeModal();
          loadFiles();
          alert('File saved successfully!');
        } else {
          alert('Error: ' + data.message);
        }
      })
      .catch(error => console.error('Error saving file:', error));
    }

    // Delete file
    function deleteFile(filename) {
      if (confirm(`Are you sure you want to delete ${filename}?`)) {
        fetch('/files/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ filename })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            loadFiles();
            alert('File deleted successfully!');
          } else {
            alert('Error: ' + data.message);
          }
        })
        .catch(error => console.error('Error deleting file:', error));
      }
    }

    // Close modal
    function closeModal() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => modal.style.display = 'none');
    }

    // Load sales
    function loadSales() {
      fetch('/sales/list')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            salesData = data.sales;
            const tableBody = document.getElementById('salesTable').querySelector('tbody');
            tableBody.innerHTML = '';
            salesData.forEach(sale => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${sale.discord}</td>
                <td>${sale.bypassType}</td>
                <td>$${sale.amount.toFixed(2)}</td>
                <td>${sale.date || 'N/A'}</td>
                <td>${new Date(sale.timestamp).toLocaleString()}</td>
              `;
              tableBody.appendChild(row);
            });
            document.getElementById('totalProfits').textContent = data.total.toFixed(2);

            // Update chart
            drawSalesChart(salesData);
          } else {
            alert('Error loading sales: ' + data.message);
          }
        })
        .catch(error => console.error('Error loading sales:', error));
    }

    // Log sale
    function logSale() {
      const discord = document.getElementById('clientDiscord').value.trim();
      const bypassType = document.getElementById('bypassType').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const date = document.getElementById('saleDate').value;
      if (!discord || !bypassType || isNaN(amount) || amount <= 0) {
        alert('Please fill all fields correctly.');
        return;
      }
      fetch('/sales/log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ discord, bypassType, amount, date })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('clientDiscord').value = '';
          document.getElementById('bypassType').value = '';
          document.getElementById('amount').value = '';
          document.getElementById('saleDate').value = '';
          loadSales();
          alert('Sale logged successfully!');
        } else {
          alert('Error: ' + data.message);
        }
      })
      .catch(error => console.error('Error logging sale:', error));
    }

    // Export to CSV
    function exportToCSV() {
      let csv = 'Client Discord,Bypass Type,Amount (USD),Date,Timestamp\n';
      salesData.forEach(sale => {
        csv += `${sale.discord},${sale.bypassType},$${sale.amount.toFixed(2)},${sale.date || 'N/A'},${sale.timestamp}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sales.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Filter sales by date
    function filterSales() {
      const startDate = prompt('Enter start date (YYYY-MM-DD):');
      const endDate = prompt('Enter end date (YYYY-MM-DD):');
      if (startDate && endDate) {
        const filtered = salesData.filter(sale => {
          const saleDate = new Date(sale.timestamp).toISOString().split('T')[0];
          return saleDate >= startDate && saleDate <= endDate;
        });
        drawSalesChart(filtered);
        // Update table with filtered data
        const tableBody = document.getElementById('salesTable').querySelector('tbody');
        tableBody.innerHTML = '';
        filtered.forEach(sale => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${sale.discord}</td>
            <th>${sale.bypassType}</th>
            <td>$${sale.amount.toFixed(2)}</td>
            <td>${sale.date || 'N/A'}</td>
            <td>${new Date(sale.timestamp).toLocaleString()}</td>
          `;
          tableBody.appendChild(row);
        });
        const total = filtered.reduce((sum, sale) => sum + sale.amount, 0);
        document.getElementById('totalProfits').textContent = total.toFixed(2);
      }
    }

    // Draw sales chart
    let chart;
    function drawSalesChart(data) {
      const ctx = document.getElementById('salesChart').getContext('2d');
      if (chart) chart.destroy();
      const dates = data.map(sale => new Date(sale.timestamp).toLocaleDateString());
      const amounts = data.map(sale => sale.amount);
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dates,
          datasets: [{
            label: 'Sales Amount ($)',
            data: amounts,
            backgroundColor: 'rgba(33, 150, 243, 0.6)',
            borderColor: 'rgba(33, 150, 243, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          responsive: true,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          }
        }
      });
    }

    // Close modal
    function closeModal() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => modal.style.display = 'none');
    }

    // Load files on page load
    window.onload = loadFiles;
  </script>
</body>
</html>